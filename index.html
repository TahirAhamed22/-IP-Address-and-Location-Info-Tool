<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultGuard Secure - Professional Password Management</title>
    <meta name="description" content="VaultGuard Secure - Professional-grade password security with HTTPS, AES-256 encryption, breach detection, and military-grade analysis.">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    
    <!-- Security Meta Tags -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
</head>
<body data-theme="dark" class="{{ 'logged-in' if logged_in else '' }}">
    <!-- Security Level Indicator -->
    <div class="security-indicator">
        <span class="security-badge" id="securityBadge">
            üîí HTTPS Secured
        </span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('home') }}" class="logo">
                <div class="logo-icon">üõ°Ô∏è</div>
                <span>VaultGuard <span class="secure-badge">SECURE</span></span>
            </a>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle">üåô</button>
                {% if logged_in %}
                    <button class="header-btn" id="securityDashboardBtn" title="Security Dashboard">üìä</button>
                    <button class="header-btn" id="notificationSettingsBtn" title="Notification Settings">üîî</button>
                    <span class="welcome-text">üë§ {{ current_user.username }}</span>
                    <div class="security-score-badge" id="securityScoreBadge">
                        <span id="securityScoreValue">-</span>%
                    </div>
                    <a href="{{ url_for('logout') }}" class="auth-btn">Secure Logout</a>
                {% else %}
                    <a href="#" class="auth-btn" id="loginBtn">Secure Access</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- HTTPS Status Alert -->
        <div id="httpsStatus" style="display: none;"></div>

        <!-- Security Status Dashboard -->
        {% if logged_in %}
        <div class="security-dashboard-card" id="securityDashboard" style="display: none;">
            <div class="dashboard-header">
                <h2>üõ°Ô∏è Security Dashboard</h2>
                <button class="close-dashboard" id="closeDashboard">√ó</button>
            </div>
            <div class="dashboard-content">
                <div class="security-metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="securityScoreMetric">-</div>
                        <div class="metric-label">Security Score</div>
                        <div class="metric-trend" id="securityTrend">‚ÜóÔ∏è Good</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalPasswordsMetric">-</div>
                        <div class="metric-label">Total Passwords</div>
                        <div class="metric-subtitle">In secure vault</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="compromisedMetric">-</div>
                        <div class="metric-label">Compromised</div>
                        <div class="metric-subtitle">Need attention</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="weakMetric">-</div>
                        <div class="metric-label">Weak</div>
                        <div class="metric-subtitle">Should strengthen</div>
                    </div>
                </div>
                
                <div class="dashboard-actions">
                    <button class="dashboard-action-btn" id="runSecurityAudit">üîç Run Security Audit</button>
                    <button class="dashboard-action-btn" id="exportVaultData">üì§ Export Vault</button>
                    <button class="dashboard-action-btn" id="manageDevices">üì± Manage Devices</button>
                </div>
                
                <div class="recent-activity">
                    <h3>Recent Security Events</h3>
                    <div class="activity-list" id="recentActivityList">
                        <div class="activity-loading">Loading security events...</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Notification Settings Modal -->
        {% if logged_in %}
        <div class="notification-settings-modal" id="notificationSettingsModal" style="display: none;">
            <div class="settings-card">
                <div class="settings-header">
                    <h2>üîî Notification Settings</h2>
                    <button class="close-settings" id="closeNotificationSettings">√ó</button>
                </div>
                <div class="settings-content">
                    <form id="notificationSettingsForm">
                        <div class="settings-section">
                            <h3>Notification Preferences</h3>
                            <div class="toggle-group">
                                <div class="toggle-item">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="emailNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <div class="toggle-info">
                                        <span class="toggle-label">Email Notifications</span>
                                        <span class="toggle-description">Receive general notifications via email</span>
                                    </div>
                                </div>
                                
                                <div class="toggle-item">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="smsNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <div class="toggle-info">
                                        <span class="toggle-label">SMS Notifications</span>
                                        <span class="toggle-description">Receive notifications via text message</span>
                                    </div>
                                </div>
                                
                                <div class="toggle-item">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="securityAlerts">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <div class="toggle-info">
                                        <span class="toggle-label">Security Alerts</span>
                                        <span class="toggle-description">Critical security notifications</span>
                                    </div>
                                </div>
                                
                                <div class="toggle-item">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="loginNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <div class="toggle-info">
                                        <span class="toggle-label">Login Notifications</span>
                                        <span class="toggle-description">Alerts for new device logins</span>
                                    </div>
                                </div>
                                
                                <div class="toggle-item">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="breachNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <div class="toggle-info">
                                        <span class="toggle-label">Breach Notifications</span>
                                        <span class="toggle-description">Alerts when passwords are compromised</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>Recovery Contact Information</h3>
                            <div class="form-group">
                                <label for="recoveryEmail" class="form-label">Recovery Email</label>
                                <input type="email" id="recoveryEmail" class="form-input" placeholder="backup@example.com">
                                <small class="form-hint">Used for password recovery if you forget your master password</small>
                            </div>
                            <div class="form-group">
                                <label for="recoveryPhone" class="form-label">Recovery Phone</label>
                                <input type="tel" id="recoveryPhone" class="form-input" placeholder="+1234567890">
                                <small class="form-hint">Alternative contact method for account recovery</small>
                            </div>
                        </div>
                        
                        <div class="settings-actions">
                            <button type="submit" class="save-settings-btn">üíæ Save Settings</button>
                            <button type="button" class="test-notifications-btn" id="testNotifications">üìß Test Notifications</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Security Status -->
        <div class="security-status-card">
            <div class="security-header">
                <h2>üõ°Ô∏è Security Status</h2>
                <div class="security-indicators">
                    <div class="security-item active" id="httpsIndicator">
                        <span class="indicator-icon">üîê</span>
                        <span>HTTPS Encryption</span>
                    </div>
                    <div class="security-item active">
                        <span class="indicator-icon">üõ°Ô∏è</span>
                        <span>AES-256 Vault</span>
                    </div>
                    <div class="security-item active">
                        <span class="indicator-icon">‚ö°</span>
                        <span>Real-time Monitoring</span>
                    </div>
                    <div class="security-item active">
                        <span class="indicator-icon">üîç</span>
                        <span>Breach Detection</span>
                    </div>
                    {% if logged_in %}
                    <div class="security-item" id="twoFactorIndicator">
                        <span class="indicator-icon">üì±</span>
                        <span>Two-Factor Auth</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">VaultGuard Secure</h1>
            <p class="hero-subtitle">Professional-Grade Password Security & Management</p>
            <div class="trust-indicators">
                <div class="trust-badge">üîí HTTPS Protected</div>
                <div class="trust-badge">üõ°Ô∏è Military Encryption</div>
                <div class="trust-badge">‚ö° Real-time Security</div>
                <div class="trust-badge">üîç Breach Monitoring</div>
                {% if logged_in %}
                <div class="trust-badge">üìß Smart Notifications</div>
                <div class="trust-badge">üì± Multi-Device Sync</div>
                {% endif %}
            </div>
        </div>

        <!-- Password Reset Section (Only show when not logged in) -->
        {% if not logged_in %}
        <div class="password-reset-card" id="passwordResetCard" style="display: none;">
            <h2 class="card-title">üîê Password Recovery</h2>
            <div class="reset-steps">
                <div class="reset-step active" id="step1">
                    <h3>Step 1: Enter Account Information</h3>
                    <form id="resetRequestForm">
                        <div class="form-group">
                            <label for="resetIdentifier" class="form-label">Username, Email, or Phone</label>
                            <input type="text" id="resetIdentifier" class="form-input" placeholder="Enter your username, email, or phone number" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reset Method</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="resetMethod" value="email" checked>
                                    <span class="radio-custom"></span>
                                    <span>üìß Email</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="resetMethod" value="sms">
                                    <span class="radio-custom"></span>
                                    <span>üì± SMS</span>
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="auth-submit">Send Reset Code</button>
                    </form>
                </div>
                
                <div class="reset-step" id="step2" style="display: none;">
                    <h3>Step 2: Enter Reset Code</h3>
                    <form id="resetVerifyForm">
                        <div class="form-group">
                            <label for="resetCode" class="form-label">Reset Code</label>
                            <input type="text" id="resetCode" class="form-input" placeholder="Enter 6-digit code" maxlength="6" required>
                            <small class="form-hint">Code sent to: <span id="maskedContact"></span></small>
                        </div>
                        <div class="form-group">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" id="newPassword" class="form-input" placeholder="Enter new strong password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="auth-submit secondary" id="backToStep1">‚Üê Back</button>
                            <button type="submit" class="auth-submit">Reset Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Password Strength Analyzer -->
        <div class="card password-analyzer">
            <h2 class="card-title">üõ°Ô∏è Military-Grade Password Analyzer</h2>
            <div class="security-notice">
                <span class="security-icon">üîë</span>
                <span>All analysis performed securely with HTTPS encryption and real-time breach detection</span>
            </div>
            
            <div class="password-input-group">
                <input type="password" class="password-input" id="passwordInput" placeholder="Enter password for secure analysis" autocomplete="off">
                <div class="input-actions">
                    <button class="input-btn" id="toggleVisibility" title="Toggle visibility">üëÅÔ∏è</button>
                    <button class="input-btn" id="copyPassword" title="Secure copy">üìã</button>
                    <button class="input-btn" id="clearPassword" title="Clear securely">üóëÔ∏è</button>
                    <button class="input-btn" id="generatePassword" title="Generate secure">‚öôÔ∏è</button>
                    <button class="input-btn" id="pauseBtn" title="Pause analysis">‚è∏Ô∏è</button>
                </div>
            </div>

            <!-- Enhanced Strength Section -->
            <div class="strength-section" id="strengthSection" style="display: none;">
                <div class="strength-label">
                    <span>Security Rating</span>
                    <span id="strengthText" class="strength-text">-</span>
                </div>
                <div class="strength-bar">
                    <div class="strength-fill" id="strengthFill"></div>
                </div>
            </div>

            <div class="analysis-grid" id="analysisResults" style="display: none;">
                <div class="analysis-item">
                    <div class="analysis-icon">‚è±Ô∏è</div>
                    <div class="analysis-label">Time to crack</div>
                    <div class="analysis-value" id="crackTime">-</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-icon">üîç</div>
                    <div class="analysis-label">Breach status</div>
                    <div class="analysis-value" id="breachStatus">-</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-icon">üìä</div>
                    <div class="analysis-label">Entropy</div>
                    <div class="analysis-value" id="entropyValue">- bits</div>
                </div>
                <div class="analysis-item">
                    <div class="analysis-icon">üìè</div>
                    <div class="analysis-label">Length</div>
                    <div class="analysis-value" id="lengthValue">- chars</div>
                </div>
            </div>

            <div id="policySection" style="display: none;">
                <h3 style="margin-bottom: 1rem; color: var(--text-secondary);">Enterprise Security Policy</h3>
                <ul class="policy-list">
                    <li class="policy-item">
                        <div class="policy-icon invalid" id="lengthIcon">‚úó</div>
                        <span>Minimum length (12+ chars)</span>
                    </li>
                    <li class="policy-item">
                        <div class="policy-icon invalid" id="lowerIcon">‚úó</div>
                        <span>Contains lowercase</span>
                    </li>
                    <li class="policy-item">
                        <div class="policy-icon invalid" id="upperIcon">‚úó</div>
                        <span>Contains uppercase</span>
                    </li>
                    <li class="policy-item">
                        <div class="policy-icon invalid" id="digitIcon">‚úó</div>
                        <span>Contains numbers</span>
                    </li>
                    <li class="policy-item">
                        <div class="policy-icon invalid" id="symbolIcon">‚úó</div>
                        <span>Contains symbols</span>
                    </li>
                </ul>
            </div>

            <!-- Password recommendations section -->
            <div id="passwordRecommendations" style="display: none;">
                <!-- Recommendations will be populated by JavaScript -->
            </div>
        </div>

        <!-- Password Generator -->
        <div class="card password-generator">
            <h2 class="card-title">‚öôÔ∏è Cryptographic Password Generator</h2>
            <div class="security-notice">
                <span class="security-icon">üîê</span>
                <span>Uses crypto.getRandomValues() for cryptographic security</span>
            </div>
            
            <div class="generator-controls">
                <div class="control-group">
                    <label class="control-label">Length: <span id="lengthValue">16</span></label>
                    <input type="range" class="slider" id="lengthSlider" min="12" max="64" value="16">
                </div>
                <div class="checkbox-grid">
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" class="checkbox" id="includeUpper" checked>
                            <label class="control-label">Uppercase (A-Z)</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" class="checkbox" id="includeLower" checked>
                            <label class="control-label">Lowercase (a-z)</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" class="checkbox" id="includeNumbers" checked>
                            <label class="control-label">Numbers (0-9)</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" class="checkbox" id="includeSymbols" checked>
                            <label class="control-label">Symbols (!@#$%)</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="generated-output">
                <input type="text" class="password-input" id="generatedPassword" placeholder="Cryptographically secure password will appear here" readonly>
                <div class="input-actions">
                    <button class="input-btn" id="copyGenerated" title="Secure copy">üìã</button>
                    <button class="input-btn" id="useGenerated" title="Test security">üîç</button>
                </div>
            </div>

            <button class="generate-btn" id="generateBtn">üé≤ Generate Secure Password</button>
        </div>

        <!-- Secure Password Vault -->
        {% if logged_in %}
        <div class="card password-vault">
            <h2 class="card-title">üîê AES-256 Encrypted Vault</h2>
            <div class="vault-header">
                <p class="vault-subtitle">Professional encryption ‚Ä¢ HTTPS protected ‚Ä¢ Zero-knowledge architecture</p>
                <div class="encryption-indicators">
                    <span class="encryption-badge">üîê AES-256</span>
                    <span class="encryption-badge">üõ°Ô∏è PBKDF2</span>
                    <span class="encryption-badge">üîí HTTPS</span>
                    <span class="encryption-badge">‚ö° Real-time</span>
                    <span class="encryption-badge">üìß Smart Alerts</span>
                </div>
            </div>
            
            <div class="vault-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Site / Service</label>
                        <input type="text" class="form-input" id="site-name" placeholder="e.g., Gmail, Banking, UPI" maxlength="120">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username / Email</label>
                        <input type="text" class="form-input" id="vault-username" placeholder="Your username or email" maxlength="120">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-input" id="vault-category">
                            <option value="General">General</option>
                            <option value="Banking">Banking</option>
                            <option value="Social Media">Social Media</option>
                            <option value="Work">Work</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="vault-password" placeholder="Enter password to encrypt">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="form-input" id="vault-notes" placeholder="Additional notes or security questions" rows="2" maxlength="500"></textarea>
                </div>
                <div class="security-hint">üîë All passwords encrypted with military-grade AES-256 before storage</div>
                <button class="save-btn" id="save-password-btn">üíæ Encrypt & Store Securely</button>
            </div>

            <!-- Enhanced Vault Search and Sort Controls -->
            <div class="vault-controls-enhanced">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input 
                            type="text" 
                            id="vault-search" 
                            placeholder="Search your encrypted passwords..." 
                            class="enhanced-search-input"
                            autocomplete="off"
                            spellcheck="false"
                        >
                        <button class="clear-search-btn" id="clearSearch" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="sort-container">
                    <label for="vault-sort" class="sort-label">Sort by:</label>
                    <div class="sort-select-wrapper">
                        <select id="vault-sort" class="enhanced-sort-select">
                            <option value="updated_at">Recently Updated</option>
                            <option value="created_at">Recently Added</option>
                            <option value="site">Site Name (A-Z)</option>
                            <option value="username">Username (A-Z)</option>
                            <option value="category">Category</option>
                            <option value="access_count">Most Accessed</option>
                        </select>
                        <svg class="sort-dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                </div>
                
                <div class="vault-actions-bar">
                    <button class="export-vault-btn" id="exportVault" title="Export Vault Data">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7,10 12,15 17,10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export
                    </button>
                    <button class="audit-vault-btn" id="auditVault" title="Security Audit">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="m9 12 2 2 4-4"></path>
                        </svg>
                        Audit
                    </button>
                </div>
            </div>

            <div class="vault-section">
                <h3 class="section-heading">üóÑÔ∏è Encrypted Password Vault</h3>
                <ul class="vault-list" id="vaultList">
                    <li style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <div class="loading-secure">üîë</div>
                        Loading encrypted vault securely...
                    </li>
                </ul>
            </div>
        </div>
        {% else %}
        <div class="card password-vault">
            <h2 class="card-title">üîê Professional Encrypted Vault</h2>
            <div class="login-prompt">
                <div class="security-visual">
                    <div class="security-icon-large">üõ°Ô∏è</div>
                    <div class="security-layers">
                        <div class="layer">HTTPS</div>
                        <div class="layer">AES-256</div>
                        <div class="layer">PBKDF2</div>
                    </div>
                </div>
                <h3>Professional Password Security</h3>
                <p>Access your military-grade encrypted vault with enterprise security features</p>
                <div class="security-features">
                    <div class="security-feature">‚úÖ HTTPS Encryption</div>
                    <div class="security-feature">‚úÖ Zero-Knowledge Architecture</div>
                    <div class="security-feature">‚úÖ Military-Grade AES-256</div>
                    <div class="security-feature">‚úÖ Real-time Breach Detection</div>
                    <div class="security-feature">‚úÖ Smart Notifications</div>
                    <div class="security-feature">‚úÖ Multi-Device Sync</div>
                    <div class="security-feature">‚úÖ Password Recovery</div>
                    <div class="security-feature">‚úÖ Security Dashboard</div>
                </div>
                <div class="cta-buttons">
                    <button class="auth-btn primary-cta" id="loginPromptBtn">üîê Access Secure Vault</button>
                    <button class="auth-btn secondary-cta" id="forgotPasswordBtn">üîë Forgot Password?</button>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Security Best Practices -->
        <div class="security-best-practices">
            <h3>üîí Professional Security Guidelines</h3>
            <div class="practices-grid">
                <div class="practice-item">
                    <div class="practice-icon">üîÑ</div>
                    <h4>Regular Rotation</h4>
                    <p>Change passwords every 90 days for critical accounts like banking and email</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">üö´</div>
                    <h4>Unique Passwords</h4>
                    <p>Never reuse passwords across different services or accounts</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">üì±</div>
                    <h4>Two-Factor Authentication</h4>
                    <p>Always enable 2FA/MFA when available for additional security</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">üîç</div>
                    <h4>Monitor Accounts</h4>
                    <p>Regularly check for suspicious activity and unauthorized access</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">‚ö†Ô∏è</div>
                    <h4>Phishing Awareness</h4>
                    <p>Be vigilant against social engineering and phishing attempts</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">üìß</div>
                    <h4>Smart Notifications</h4>
                    <p>Enable breach alerts and login notifications for early detection</p>
                </div>
            </div>
        </div>

        <!-- Critical Security Notice -->
        <div class="critical-security-notice">
            <h3>üö® Important Security Information</h3>
            <div class="notice-grid">
                <div class="notice-item">
                    <h4>üõ°Ô∏è Enhanced Security Features</h4>
                    <ul>
                        <li>HTTPS/TLS encryption for all data transmission</li>
                        <li>AES-256 encryption for password storage</li>
                        <li>PBKDF2 key derivation with 600,000 iterations</li>
                        <li>Real-time breach detection via HaveIBeenPwned</li>
                        <li>Smart notifications via email and SMS</li>
                        <li>Device fingerprinting and trust management</li>
                        <li>Comprehensive security dashboard and audit</li>
                        <li>Password recovery via multiple methods</li>
                    </ul>
                </div>
                <div class="notice-item">
                    <h4>‚ö†Ô∏è Security Best Practices</h4>
                    <ul>
                        <li>Use a strong, unique master password</li>
                        <li>Enable all security notifications</li>
                        <li>Set up recovery email and phone</li>
                        <li>Run regular security audits</li>
                        <li>Monitor your security dashboard</li>
                        <li>Keep your device software updated</li>
                        <li>Use HTTPS connection always</li>
                        <li>Log out when using shared devices</li>
                    </ul>
                </div>
            </div>
            <div class="critical-reminder">
                <p><strong>Security Reality Check:</strong></p>
                <p>This enhanced VaultGuard implements professional security measures including HTTPS, AES-256 encryption, real-time breach detection, and smart notifications. However:</p>
                <ul>
                    <li>Security depends on proper hosting and infrastructure</li>
                    <li>Your master password is the most critical component</li>
                    <li>Enable all security features and notifications</li>
                    <li>Regularly audit your passwords and monitor alerts</li>
                    <li>Consider enterprise solutions for business-critical data</li>
                </ul>
            </div>
        </div>

        <!-- Footer with Terms and Privacy Links -->
        <div class="footer-links">
            <a href="{{ url_for('terms') }}" target="_blank">Terms of Service</a>
            <a href="{{ url_for('privacy') }}" target="_blank">Privacy Policy</a>
            <a href="{{ url_for('security') }}" target="_blank">Security Information</a>
            <a href="mailto:security@vaultguard.local">Security Contact</a>
            <span style="color: var(--text-secondary); font-size: 0.8rem;">¬© <span id="currentYear">2024</span> VaultGuard Secure</span>
        </div>
    </div>

    <!-- Enhanced Auth Modal -->
    {% if not logged_in %}
    <div class="auth-modal" id="authModal">
        <div class="auth-card">
            <button class="close-btn" id="closeModal">√ó</button>
            <h2 class="auth-title" id="authTitle">üîê VaultGuard Secure Access</h2>
            <div class="security-auth-notice">
                <span class="security-icon">üîë</span>
                <span>HTTPS Protected ‚Ä¢ Secure Authentication ‚Ä¢ Smart Notifications</span>
            </div>
            <form class="auth-form" id="authForm" method="POST">
                <input type="text" class="auth-input" id="authUsername" name="username" placeholder="Username (3+ characters)" required autocomplete="username">
                <input type="email" class="auth-input" id="authEmail" name="email" placeholder="Email (optional for login)" autocomplete="email">
                <input type="tel" class="auth-input" id="authPhone" name="phone" placeholder="Phone (optional)" autocomplete="tel">
                <input type="password" class="auth-input" id="authPassword" name="password" placeholder="Master Password (12+ characters)" required autocomplete="current-password">
                <div class="password-requirements">
                    <small>Strong password required: 12+ chars, uppercase, lowercase, numbers, symbols</small>
                </div>
                <button type="submit" class="auth-submit" id="authSubmit">Secure Login</button>
            </form>
            <p class="auth-switch">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" class="auth-link" id="authSwitchLink">Create Secure Account</a>
            </p>
            <div class="auth-security-info">
                <h4>Security Features:</h4>
                <ul>
                    <li>HTTPS encryption for all data</li>
                    <li>Smart breach notifications</li>
                    <li>Multi-device login alerts</li>
                    <li>Password recovery options</li>
                    <li>Security dashboard & audit</li>
                    <li>Zero-knowledge encryption</li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Security Audit Results Modal -->
    {% if logged_in %}
    <div class="audit-results-modal" id="auditResultsModal" style="display: none;">
        <div class="audit-card">
            <div class="audit-header">
                <h2>üîç Security Audit Results</h2>
                <button class="close-audit" id="closeAuditResults">√ó</button>
            </div>
            <div class="audit-content">
                <div class="audit-summary" id="auditSummary">
                    <!-- Audit results will be populated here -->
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
    <script>
        // Update copyright year
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // Enhanced security status checker
        function checkSecurityStatus() {
            const isHTTPS = location.protocol === 'https:';
            const securityBadge = document.getElementById('securityBadge');
            const httpsStatus = document.getElementById('httpsStatus');
            const httpsIndicator = document.getElementById('httpsIndicator');
            
            if (securityBadge) {
                if (isHTTPS) {
                    securityBadge.innerHTML = 'üîí HTTPS Secured';
                    securityBadge.style.background = 'linear-gradient(135deg, #2ed573, #17d97a)';
                    securityBadge.style.color = 'white';
                } else {
                    securityBadge.innerHTML = '‚ö†Ô∏è HTTP (Not Secure)';
                    securityBadge.style.background = 'linear-gradient(135deg, #ff4757, #ff3742)';
                    securityBadge.style.color = 'white';
                }
            }

            // Update HTTPS status alert
            if (httpsStatus) {
                if (!isHTTPS) {
                    httpsStatus.innerHTML = `
                        <div class="https-warning">
                            üö® <strong>Security Warning:</strong> You are using HTTP instead of HTTPS. 
                            Your data may be vulnerable to interception. Please use HTTPS for maximum security.
                        </div>
                    `;
                    httpsStatus.style.display = 'block';
                } else {
                    httpsStatus.innerHTML = `
                        <div class="https-secure">
                            üîí <strong>Secure Connection:</strong> HTTPS encryption is active. 
                            All data protected with military-grade encryption.
                        </div>
                    `;
                    httpsStatus.style.display = 'block';
                    // Hide after 3 seconds
                    setTimeout(() => {
                        httpsStatus.style.display = 'none';
                    }, 3000);
                }
            }

            // Update security indicator
            if (httpsIndicator) {
                if (!isHTTPS) {
                    httpsIndicator.classList.remove('active');
                    httpsIndicator.querySelector('.indicator-icon').textContent = '‚ö†Ô∏è';
                    httpsIndicator.style.borderColor = 'var(--accent-red)';
                    httpsIndicator.style.background = 'rgba(255, 71, 87, 0.1)';
                }
            }
        }

        // Session timeout warning
        let sessionWarningShown = false;
        let sessionTimeout = 25 * 60 * 1000; // 25 minutes (5 min before 30 min timeout)

        function showSessionWarning() {
            if (!sessionWarningShown && document.body.classList.contains('logged-in')) {
                sessionWarningShown = true;
                if (typeof showNotification === 'function') {
                    showNotification('Session expires in 5 minutes. Save your work!', 'warning');
                }
            }
        }

        // Initialize security status and session management
        document.addEventListener('DOMContentLoaded', () => {
            checkSecurityStatus();
            
            // Security warning for HTTP
            if (location.protocol !== 'https:') {
                setTimeout(() => {
                    if (typeof showNotification === 'function') {
                        showNotification('Security Warning: Use HTTPS for maximum protection', 'warning');
                    }
                }, 2000);
            }

            // Session timeout warning (only for logged in users)
            if (document.body.classList.contains('logged-in')) {
                setTimeout(showSessionWarning, sessionTimeout);
            }
        });

        // Enhanced clipboard security
        function secureClipboardClear() {
            if (navigator.clipboard) {
                navigator.clipboard.writeText('').catch(() => {
                    // Fallback: try to clear with dummy text
                    navigator.clipboard.writeText('clipboard_cleared_for_security').catch(() => {});
                });
            }
        }

        // Clear clipboard on page unload
        window.addEventListener('beforeunload', () => {
            secureClipboardClear();
        });

        // Clear clipboard after 30 seconds of any copy operation
        let clipboardTimeout;
        document.addEventListener('copy', () => {
            clearTimeout(clipboardTimeout);
            clipboardTimeout = setTimeout(secureClipboardClear, 30000);
        });

        // Password reset functionality
        
        document.getElementById('forgotPasswordBtn')?.addEventListener('click', () => {
            document.getElementById('passwordResetCard').style.display = 'block';
            document.getElementById('passwordResetCard').scrollIntoView({ behavior: 'smooth' });
        });

        // Reset request form
        document.getElementById('resetRequestForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const identifier = document.getElementById('resetIdentifier').value;
            const method = document.querySelector('input[name="resetMethod"]:checked').value;
            
            try {
                const response = await fetch('/api/reset-password/request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identifier, method })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('step1').style.display = 'none';
                    document.getElementById('step2').style.display = 'block';
                    document.getElementById('maskedContact').textContent = data.masked_contact || 'your contact method';
                    showNotification(data.message, 'success');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Network error. Please try again.', 'error');
            }
        });

        // Reset verification form
        document.getElementById('resetVerifyForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const resetCode = document.getElementById('resetCode').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/reset-password/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reset_code: resetCode, new_password: newPassword })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(data.message, 'success');
                    document.getElementById('passwordResetCard').style.display = 'none';
                    // Optionally redirect to login
                    setTimeout(() => {
                        document.getElementById('loginBtn').click();
                    }, 2000);
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Network error. Please try again.', 'error');
            }
        });

        document.getElementById('backToStep1')?.addEventListener('click', () => {
            document.getElementById('step2').style.display = 'none';
            document.getElementById('step1').style.display = 'block';
        });
        
        // Security Dashboard functionality
        document.getElementById('securityDashboardBtn')?.addEventListener('click', loadSecurityDashboard);
        document.getElementById('closeDashboard')?.addEventListener('click', () => {
            document.getElementById('securityDashboard').style.display = 'none';
        });

        async function loadSecurityDashboard() {
            try {
                const response = await fetch('/api/security/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    const dashboard = data.dashboard;
                    
                    // Update security metrics
                    document.getElementById('securityScoreMetric').textContent = dashboard.security_score;
                    document.getElementById('totalPasswordsMetric').textContent = dashboard.total_passwords;
                    document.getElementById('compromisedMetric').textContent = dashboard.compromised_passwords;
                    document.getElementById('weakMetric').textContent = dashboard.weak_passwords;
                    
                    // Update security score in header
                    document.getElementById('securityScoreValue').textContent = dashboard.security_score;
                    
                    // Update recent activity
                    const activityList = document.getElementById('recentActivityList');
                    if (dashboard.recent_events.length > 0) {
                        activityList.innerHTML = dashboard.recent_events.map(event => `
                            <div class="activity-item ${event.severity.toLowerCase()}">
                                <div class="activity-icon">${getEventIcon(event.type)}</div>
                                <div class="activity-details">
                                    <div class="activity-description">${event.description}</div>
                                    <div class="activity-timestamp">${formatTimestamp(event.timestamp)}</div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        activityList.innerHTML = '<div class="no-activity">No recent security events</div>';
                    }
                    
                    document.getElementById('securityDashboard').style.display = 'block';
                } else {
                    showNotification('Failed to load security dashboard', 'error');
                }
            } catch (error) {
                showNotification('Network error loading dashboard', 'error');
            }
        }

        function getEventIcon(eventType) {
            const icons = {
                'LOGIN_SUCCESS': 'üîê',
                'LOGIN_FAILED': '‚ùå',
                'PASSWORD_ADDED': 'üíæ',
                'PASSWORD_ACCESSED': 'üëÅÔ∏è',
                'SECURITY_AUDIT': 'üîç',
                'ACCOUNT_LOCKED': 'üîí',
                'SETTINGS_UPDATED': '‚öôÔ∏è'
            };
            return icons[eventType] || 'üìù';
        }

        // Notification Settings functionality
        document.getElementById('notificationSettingsBtn')?.addEventListener('click', loadNotificationSettings);
        document.getElementById('closeNotificationSettings')?.addEventListener('click', () => {
            document.getElementById('notificationSettingsModal').style.display = 'none';
        });

        async function loadNotificationSettings() {
            try {
                const response = await fetch('/api/settings/notifications');
                const data = await response.json();
                
                if (data.success) {
                    const settings = data.settings;
                    
                    // Populate form with current settings
                    document.getElementById('emailNotifications').checked = settings.email_notifications;
                    document.getElementById('smsNotifications').checked = settings.sms_notifications;
                    document.getElementById('securityAlerts').checked = settings.security_alerts;
                    document.getElementById('loginNotifications').checked = settings.login_notifications;
                    document.getElementById('breachNotifications').checked = settings.breach_notifications;
                    document.getElementById('recoveryEmail').value = settings.recovery_email || '';
                    document.getElementById('recoveryPhone').value = settings.recovery_phone || '';
                    
                    document.getElementById('notificationSettingsModal').style.display = 'block';
                } else {
                    showNotification('Failed to load notification settings', 'error');
                }
            } catch (error) {
                showNotification('Network error loading settings', 'error');
            }
        }

        // Save notification settings
        document.getElementById('notificationSettingsForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const settings = {
                email_notifications: document.getElementById('emailNotifications').checked,
                sms_notifications: document.getElementById('smsNotifications').checked,
                security_alerts: document.getElementById('securityAlerts').checked,
                login_notifications: document.getElementById('loginNotifications').checked,
                breach_notifications: document.getElementById('breachNotifications').checked,
                recovery_email: document.getElementById('recoveryEmail').value,
                recovery_phone: document.getElementById('recoveryPhone').value
            };
            
            try {
                const response = await fetch('/api/settings/notifications', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Notification settings saved successfully', 'success');
                    document.getElementById('notificationSettingsModal').style.display = 'none';
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Network error saving settings', 'error');
            }
        });

        // Test notifications
        document.getElementById('testNotifications')?.addEventListener('click', () => {
            showNotification('Test notification sent! Check your email and phone.', 'info');
        });

        // Security Audit functionality
        document.getElementById('auditVault')?.addEventListener('click', runSecurityAudit);
        document.getElementById('runSecurityAudit')?.addEventListener('click', runSecurityAudit);

        async function runSecurityAudit() {
            const masterPassword = prompt('üîê Enter your master password to run security audit:');
            if (!masterPassword) return;
            
            try {
                showNotification('Running comprehensive security audit...', 'info');
                
                const response = await fetch('/api/vault/security-audit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ master_password: masterPassword })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayAuditResults(data.audit_results);
                    showNotification('Security audit completed successfully', 'success');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Network error during audit', 'error');
            }
        }

        function displayAuditResults(results) {
            const summaryDiv = document.getElementById('auditSummary');
            
            summaryDiv.innerHTML = `
                <div class="audit-overview">
                    <h3>Audit Overview</h3>
                    <div class="audit-stats">
                        <div class="audit-stat">
                            <span class="stat-number">${results.total_passwords}</span>
                            <span class="stat-label">Total Passwords</span>
                        </div>
                        <div class="audit-stat critical">
                            <span class="stat-number">${results.compromised_count}</span>
                            <span class="stat-label">Compromised</span>
                        </div>
                        <div class="audit-stat warning">
                            <span class="stat-number">${results.weak_count}</span>
                            <span class="stat-label">Weak</span>
                        </div>
                        <div class="audit-stat info">
                            <span class="stat-number">${results.duplicate_count}</span>
                            <span class="stat-label">Duplicates</span>
                        </div>
                        <div class="audit-stat warning">
                            <span class="stat-number">${results.old_count}</span>
                            <span class="stat-label">Old (90+ days)</span>
                        </div>
                    </div>
                </div>
                
                ${results.compromised_count > 0 ? `
                <div class="audit-section critical">
                    <h4>üö® Compromised Passwords (Immediate Action Required)</h4>
                    <div class="compromised-list">
                        ${results.compromised_sites.map(site => `
                            <div class="compromised-item">
                                <span class="site-name">${site.site}</span>
                                <span class="breach-count">${site.breach_count.toLocaleString()} breaches</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${results.weak_count > 0 ? `
                <div class="audit-section warning">
                    <h4>‚ö†Ô∏è Weak Passwords</h4>
                    <div class="weak-list">
                        ${results.weak_sites.map(site => `
                            <div class="weak-item">
                                <span class="site-name">${site.site}</span>
                                <span class="strength-score">${site.strength_score}% strength</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
            
            document.getElementById('auditResultsModal').style.display = 'block';
        }

        document.getElementById('closeAuditResults')?.addEventListener('click', () => {
            document.getElementById('auditResultsModal').style.display = 'none';
        });

        // Export functionality
        document.getElementById('exportVault')?.addEventListener('click', exportVaultData);
        document.getElementById('exportVaultData')?.addEventListener('click', exportVaultData);

        async function exportVaultData() {
            const masterPassword = prompt('üîê Enter your master password to export vault:');
            if (!masterPassword) return;
            
            try {
                const response = await fetch('/api/vault/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ master_password: masterPassword, format: 'json' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Create and download file
                    const blob = new Blob([JSON.stringify(data.data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `vaultguard-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification(`Exported ${data.exported_count} passwords successfully`, 'success');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Network error during export', 'error');
            }
        }
        
        // Load security score on page load
        if (document.body.classList.contains('logged-in')) {
            loadSecurityDashboard();
        }
        
    </script>
</body>
</html>
