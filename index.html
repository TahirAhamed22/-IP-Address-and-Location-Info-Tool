<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultGuard Secure - Professional Password Management</title>
    <meta name="description" content="VaultGuard Secure - Professional-grade password security with HTTPS, AES-256 encryption, breach detection, and military-grade analysis.">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🛡️</text></svg>">
    
    <!-- Security Meta Tags -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">
</head>
<body data-theme="dark" class="{{ 'logged-in' if logged_in else '' }}">
    <!-- Security Level Indicator -->
    <div class="security-indicator">
        <span class="security-badge" id="securityBadge">
            🔒 HTTPS Secured
        </span>
    </div>

    <!-- Enhanced Header -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('home') }}" class="logo">
                <div class="logo-icon">🛡️</div>
                <span>VaultGuard <span class="secure-badge">SECURE</span></span>
            </a>
            
            <!-- Navigation Menu -->
            {% if logged_in %}
            <nav class="main-nav">
                <a href="#dashboard" class="nav-link active" data-section="dashboard">
                    <span class="nav-icon">📊</span>
                    <span>Dashboard</span>
                </a>
                <a href="#vault" class="nav-link" data-section="vault">
                    <span class="nav-icon">🔐</span>
                    <span>Vault</span>
                    <span class="vault-count-badge" id="vaultCountBadge">0</span>
                </a>
                <a href="#analyzer" class="nav-link" data-section="analyzer">
                    <span class="nav-icon">🔍</span>
                    <span>Analyzer</span>
                </a>
                <a href="#generator" class="nav-link" data-section="generator">
                    <span class="nav-icon">⚙️</span>
                    <span>Generator</span>
                </a>
                <a href="#security" class="nav-link" data-section="security">
                    <span class="nav-icon">🛡️</span>
                    <span>Security</span>
                </a>
            </nav>
            {% endif %}
            
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle">🌙</button>
                
                {% if logged_in %}
                    <!-- Notifications Bell -->
                    <div class="notification-bell" id="notificationBell">
                        <span class="bell-icon">🔔</span>
                        <span class="notification-count" id="notificationCount" style="display: none;">0</span>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="user-menu">
                        <button class="user-avatar" id="userMenuToggle">
                            <span class="user-initial">{{ current_user.username[0].upper() if current_user else 'U' }}</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-info">
                                <div class="user-name">{{ current_user.username if current_user else 'User' }}</div>
                                <div class="user-email">{{ current_user.email if current_user and current_user.email else 'No email set' }}</div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="#profile" class="dropdown-item">
                                <span class="item-icon">👤</span>
                                <span>Profile Settings</span>
                            </a>
                            <a href="#notifications" class="dropdown-item">
                                <span class="item-icon">🔔</span>
                                <span>Notifications</span>
                                <span class="notification-badge" id="dropdownNotificationBadge" style="display: none;">0</span>
                            </a>
                            <a href="#security-center" class="dropdown-item">
                                <span class="item-icon">🛡️</span>
                                <span>Security Center</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="{{ url_for('logout') }}" class="dropdown-item logout-item">
                                <span class="item-icon">🚪</span>
                                <span>Secure Logout</span>
                            </a>
                        </div>
                    </div>
                {% else %}
                    <a href="#" class="auth-btn" id="loginBtn">Secure Access</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        {% if not logged_in %}
        <!-- HTTPS Status Alert -->
        <div id="httpsStatus" style="display: none;"></div>

        <!-- Security Status -->
        <div class="security-status-card">
            <div class="security-header">
                <h2>🛡️ Security Status</h2>
                <div class="security-indicators">
                    <div class="security-item active" id="httpsIndicator">
                        <span class="indicator-icon">🔐</span>
                        <span>HTTPS Encryption</span>
                    </div>
                    <div class="security-item active">
                        <span class="indicator-icon">🛡️</span>
                        <span>AES-256 Vault</span>
                    </div>
                    <div class="security-item active">
                        <span class="indicator-icon">⚡</span>
                        <span>Real-time Monitoring</span>
                    </div>
                    <div class="security-item active">
                        <span class="indicator-icon">🔍</span>
                        <span>Breach Detection</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">VaultGuard Secure</h1>
            <p class="hero-subtitle">Professional-Grade Password Security & Management</p>
            <div class="trust-indicators">
                <div class="trust-badge">🔒 HTTPS Protected</div>
                <div class="trust-badge">🛡️ Military Encryption</div>
                <div class="trust-badge">⚡ Real-time Security</div>
                <div class="trust-badge">🔍 Breach Monitoring</div>
                <div class="trust-badge">📱 SMS/Email Alerts</div>
                <div class="trust-badge">🔐 OTP Recovery</div>
            </div>
            
            <!-- Enhanced Features Grid -->
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">🔐</div>
                    <h4>AES-256 Encryption</h4>
                    <p>Military-grade encryption protects your passwords with unbreakable security</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔍</div>
                    <h4>Live Breach Detection</h4>
                    <p>Real-time monitoring against HaveIBeenPwned database of 12+ billion breached passwords</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📱</div>
                    <h4>Smart Notifications</h4>
                    <p>Get instant alerts via email and SMS for breaches, new device logins, and security updates</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔑</div>
                    <h4>OTP Recovery System</h4>
                    <p>Secure password recovery via email or SMS OTP when you forget your master password</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">💻</div>
                    <h4>Device Management</h4>
                    <p>Track and manage all your devices with automatic new device detection and alerts</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📊</div>
                    <h4>Security Analytics</h4>
                    <p>Comprehensive dashboard with security score, breach status, and personalized recommendations</p>
                </div>
            </div>
        </div>
        {% else %}
        
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="main-section active">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">📊</span>
                    Security Dashboard
                </h2>
                <div class="section-actions">
                    <button class="refresh-btn" onclick="refreshDashboard()">
                        <span class="btn-icon">🔄</span>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>
            
            <!-- Security Score Card -->
            <div class="security-score-card">
                <div class="score-header">
                    <h3>Your Security Score</h3>
                    <div class="score-circle">
                        <div class="score-value" id="securityScore">--</div>
                        <div class="score-grade" id="securityGrade">-</div>
                    </div>
                </div>
                <div class="score-breakdown">
                    <div class="breakdown-item">
                        <span class="item-label">Strong Passwords</span>
                        <span class="item-value" id="strongPasswordsCount">--</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="item-label">Compromised</span>
                        <span class="item-value critical" id="compromisedCount">--</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="item-label">Old Passwords</span>
                        <span class="item-value warning" id="oldPasswordsCount">--</span>
                    </div>
                </div>
            </div>
            
            <!-- Quick Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">🔐</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalPasswords">--</div>
                        <div class="stat-label">Total Passwords</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📱</div>
                    <div class="stat-content">
                        <div class="stat-value" id="trustedDevices">--</div>
                        <div class="stat-label">Trusted Devices</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🔔</div>
                    <div class="stat-content">
                        <div class="stat-value" id="activeAlerts">--</div>
                        <div class="stat-label">Active Alerts</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-content">
                        <div class="stat-value" id="vaultUsage">--%</div>
                        <div class="stat-label">Vault Usage</div>
                    </div>
                </div>
            </div>
            
            <!-- Security Recommendations -->
            <div class="recommendations-section">
                <h3>🎯 Security Recommendations</h3>
                <div class="recommendations-list" id="recommendationsList">
                    <!-- Dynamic recommendations will be loaded here -->
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="recent-activity-section">
                <h3>📈 Recent Activity</h3>
                <div class="activity-tabs">
                    <button class="tab-btn active" data-tab="password-access">Password Access</button>
                    <button class="tab-btn" data-tab="security-events">Security Events</button>
                    <button class="tab-btn" data-tab="device-logins">Device Logins</button>
                </div>
                <div class="activity-content">
                    <div class="activity-list" id="recentActivityList">
                        <!-- Dynamic activity will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Vault Section -->
        <section id="vault-section" class="main-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">🔐</span>
                    AES-256 Encrypted Vault
                </h2>
                <div class="vault-subtitle">
                    Professional encryption • HTTPS protected • Zero-knowledge architecture
                </div>
            </div>
            
            <!-- Enhanced Vault Controls -->
            <div class="vault-controls-enhanced">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input 
                            type="text" 
                            id="vault-search" 
                            placeholder="Search your encrypted passwords..." 
                            class="enhanced-search-input"
                            autocomplete="off"
                            spellcheck="false"
                        >
                        <button class="clear-search-btn" id="clearSearch" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="filter-container">
                    <select id="category-filter" class="enhanced-filter-select">
                        <option value="">All Categories</option>
                        <!-- Dynamic categories loaded -->
                    </select>
                </div>
                
                <div class="sort-container">
                    <label for="vault-sort" class="sort-label">Sort by:</label>
                    <div class="sort-select-wrapper">
                        <select id="vault-sort" class="enhanced-sort-select">
                            <option value="updated_at">Recently Updated</option>
                            <option value="created_at">Recently Added</option>
                            <option value="site">Site Name (A-Z)</option>
                            <option value="username">Username (A-Z)</option>
                            <option value="access_count">Most Accessed</option>
                            <option value="password_age_days">Password Age</option>
                        </select>
                        <svg class="sort-dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                </div>
                
                <div class="vault-actions-bar">
                    <button class="export-vault-btn" id="exportVaultBtn" title="Export Vault Data">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7,10 12,15 17,10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export
                    </button>
                    <button class="breach-check-btn" id="breachCheckBtn" title="Check All Passwords for Breaches">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        Check Breaches
                    </button>
                </div>
            </div>
            
            <!-- Add Password Form -->
            <div class="vault-form">
                <div class="form-header">
                    <h3>💾 Add New Password</h3>
                    <p>All data encrypted with AES-256 before storage</p>
                </div>
                
                <div class="form-grid">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Site / Service *</label>
                            <input type="text" class="form-input" id="site-name" placeholder="e.g., Gmail, Banking, GitHub" maxlength="120" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username / Email *</label>
                            <input type="text" class="form-input" id="vault-username" placeholder="Your username or email" maxlength="120" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-input" id="vault-category">
                                <option value="General">General</option>
                                <option value="Banking">Banking</option>
                                <option value="Social">Social Media</option>
                                <option value="Work">Work</option>
                                <option value="Shopping">Shopping</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Education">Education</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Website URL</label>
                            <input type="url" class="form-input" id="vault-url" placeholder="https://example.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <div class="password-input-container">
                            <input type="password" class="form-input" id="vault-password" placeholder="Enter password to encrypt" required>
                            <button type="button" class="password-toggle-btn" onclick="toggleVaultPasswordVisibility()">👁️</button>
                            <button type="button" class="generate-password-btn" onclick="generatePasswordForVault()">⚙️</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notes (Optional)</label>
                        <textarea class="form-input" id="vault-notes" placeholder="Secure notes (will be encrypted)" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tags</label>
                        <input type="text" class="form-input" id="vault-tags" placeholder="work, important, backup (comma separated)">
                    </div>
                </div>
                
                <button class="save-btn" id="save-password-btn">💾 Encrypt & Store Securely</button>
            </div>
            
            <!-- Vault Entries List -->
            <div class="vault-section">
                <h3 class="section-heading">🗄️ Your Encrypted Passwords</h3>
                <div class="vault-stats" id="vaultStatsContainer" style="display: none;">
                    <!-- Dynamic stats loaded here -->
                </div>
                <ul class="vault-list" id="vaultList">
                    <li class="vault-loading">
                        <div class="loading-secure">🔑</div>
                        <p>Loading encrypted vault securely...</p>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Password Analyzer Section -->
        <section id="analyzer-section" class="main-section">
            <div class="card password-analyzer">
                <h2 class="card-title">🛡️ Military-Grade Password Analyzer</h2>
                <div class="security-notice">
                    <span class="security-icon">🔑</span>
                    <span>Real-time analysis with HaveIBeenPwned breach detection</span>
                </div>
                
                <div class="password-input-group">
                    <input type="password" class="password-input" id="passwordInput" placeholder="Enter password for comprehensive security analysis" autocomplete="off">
                    <div class="input-actions">
                        <button class="input-btn" id="toggleVisibility" title="Toggle visibility">👁️</button>
                        <button class="input-btn" id="copyPassword" title="Secure copy">📋</button>
                        <button class="input-btn" id="clearPassword" title="Clear securely">🗑️</button>
                        <button class="input-btn" id="generatePassword" title="Generate secure">⚙️</button>
                        <button class="input-btn" id="pauseBtn" title="Pause analysis">⏸️</button>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="strength-section" id="strengthSection" style="display: none;">
                    <div class="strength-label">
                        <span>Security Rating</span>
                        <span id="strengthText" class="strength-text">-</span>
                    </div>
                    <div class="strength-bar">
                        <div class="strength-fill" id="strengthFill"></div>
                    </div>
                </div>

                <div class="analysis-grid" id="analysisResults" style="display: none;">
                    <div class="analysis-item">
                        <div class="analysis-icon">⏱️</div>
                        <div class="analysis-label">Time to crack</div>
                        <div class="analysis-value" id="crackTime">-</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-icon">🔍</div>
                        <div class="analysis-label">Breach status</div>
                        <div class="analysis-value" id="breachStatus">-</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-icon">🔢</div>
                        <div class="analysis-label">Entropy</div>
                        <div class="analysis-value" id="passwordEntropy">- bits</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-icon">🎯</div>
                        <div class="analysis-label">Security Level</div>
                        <div class="analysis-value" id="securityLevel">-</div>
                    </div>
                </div>

                <div id="policySection" style="display: none;">
                    <h3 style="margin-bottom: 1rem; color: var(--text-secondary);">Enterprise Security Policy</h3>
                    <ul class="policy-list">
                        <li class="policy-item">
                            <div class="policy-icon" id="lengthIcon">○</div>
                            <span>Minimum length (12+ chars)</span>
                        </li>
                        <li class="policy-item">
                            <div class="policy-icon" id="lowerIcon">○</div>
                            <span>Contains lowercase</span>
                        </li>
                        <li class="policy-item">
                            <div class="policy-icon" id="upperIcon">○</div>
                            <span>Contains uppercase</span>
                        </li>
                        <li class="policy-item">
                            <div class="policy-icon" id="digitIcon">○</div>
                            <span>Contains numbers</span>
                        </li>
                        <li class="policy-item">
                            <div class="policy-icon" id="symbolIcon">○</div>
                            <span>Contains symbols</span>
                        </li>
                    </ul>
                </div>

                <div id="passwordRecommendations" style="display: none;">
                    <!-- Recommendations populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Password Generator Section -->
        <section id="generator-section" class="main-section">
            <div class="card password-generator">
                <h2 class="card-title">⚙️ Cryptographic Password Generator</h2>
                <div class="security-notice">
                    <span class="security-icon">🔐</span>
                    <span>Uses crypto.getRandomValues() for cryptographic security</span>
                </div>
                
                <div class="generator-controls">
                    <div class="control-group">
                        <label class="control-label">Length: <span id="lengthValue">16 (Strong)</span></label>
                        <input type="range" class="slider" id="lengthSlider" min="12" max="64" value="16">
                    </div>
                    
                    <div class="checkbox-grid">
                        <div class="control-group">
                            <div class="checkbox-group">
                                <input type="checkbox" class="checkbox" id="includeUpper" checked>
                                <label class="control-label">Uppercase (A-Z)</label>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="checkbox-group">
                                <input type="checkbox" class="checkbox" id="includeLower" checked>
                                <label class="control-label">Lowercase (a-z)</label>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="checkbox-group">
                                <input type="checkbox" class="checkbox" id="includeNumbers" checked>
                                <label class="control-label">Numbers (0-9)</label>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="checkbox-group">
                                <input type="checkbox" class="checkbox" id="includeSymbols" checked>
                                <label class="control-label">Symbols (!@#$%)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="generated-output">
                    <input type="text" class="password-input" id="generatedPassword" placeholder="Cryptographically secure password will appear here" readonly>
                    <div class="input-actions">
                        <button class="input-btn" id="copyGenerated" title="Secure copy">📋</button>
                        <button class="input-btn" id="useGenerated" title="Test security">🔍</button>
                        <button class="input-btn" id="analyzeGenerated" title="Analyze strength">📊</button>
                    </div>
                </div>

                <button class="generate-btn" id="generateBtn">🎲 Generate Secure Password</button>
            </div>
        </section>

        <!-- Security Center Section -->
        <section id="security-section" class="main-section">
            <div class="security-center-layout">
                <!-- Device Management -->
                <div class="security-card">
                    <div class="card-header">
                        <h3>💻 Trusted Devices</h3>
                        <span class="device-count" id="deviceCount">0</span>
                    </div>
                    <div class="device-list" id="deviceList">
                        <!-- Dynamic device list -->
                    </div>
                </div>

                <!-- Security Events -->
                <div class="security-card">
                    <div class="card-header">
                        <h3>🔒 Security Events</h3>
                        <button class="view-all-btn" onclick="viewAllSecurityEvents()">View All</button>
                    </div>
                    <div class="events-list" id="securityEventsList">
                        <!-- Dynamic events list -->
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="security-card">
                    <div class="card-header">
                        <h3>🔔 Notification Preferences</h3>
                    </div>
                    <div class="notification-settings">
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Breach Alerts</label>
                                <p>Get notified when passwords are found in breaches</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="breachAlerts" checked>
                                <label for="breachAlerts"></label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>New Device Login</label>
                                <p>Alert when logging in from new devices</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="newDeviceAlerts" checked>
                                <label for="newDeviceAlerts"></label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Password Age Warnings</label>
                                <p>Remind to update old passwords (90+ days)</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="passwordAgeAlerts" checked>
                                <label for="passwordAgeAlerts"></label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Email Notifications</label>
                                <p>Receive alerts via email</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="emailNotifications">
                                <label for="emailNotifications"></label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>SMS Notifications</label>
                                <p>Receive urgent alerts via SMS</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="smsNotifications">
                                <label for="smsNotifications"></label>
                            </div>
                        </div>
                    </div>
                    
                    <button class="save-settings-btn" onclick="saveNotificationSettings()">Save Preferences</button>
                </div>

                <!-- Profile Settings -->
                <div class="security-card">
                    <div class="card-header">
                        <h3>👤 Profile & Recovery</h3>
                    </div>
                    <div class="profile-form">
                        <div class="form-group">
                            <label>Email Address (for notifications & recovery)</label>
                            <input type="email" class="form-input" id="profileEmail" placeholder="your-email@example.com">
                            <small class="form-hint">Used for breach alerts and password recovery</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number (for SMS alerts & recovery)</label>
                            <input type="tel" class="form-input" id="profilePhone" placeholder="+1234567890">
                            <small class="form-hint">Format: +1234567890 (with country code)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Timezone</label>
                            <select class="form-input" id="profileTimezone">
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern Time</option>
                                <option value="America/Chicago">Central Time</option>
                                <option value="America/Denver">Mountain Time</option>
                                <option value="America/Los_Angeles">Pacific Time</option>
                                <option value="Europe/London">London</option>
                                <option value="Europe/Berlin">Berlin</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                                <option value="Asia/Kolkata">India Standard Time</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="save-settings-btn" onclick="saveProfileSettings()">Update Profile</button>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile-section" class="main-section">
            <div class="profile-layout">
                <div class="profile-header">
                    <div class="profile-avatar-large">
                        {{ current_user.username[0].upper() if current_user else 'U' }}
                    </div>
                    <div class="profile-info">
                        <h2>{{ current_user.username if current_user else 'User' }}</h2>
                        <p class="profile-email">{{ current_user.email if current_user and current_user.email else 'No email set' }}</p>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="profileLoginCount">--</span>
                                <span class="stat-label">Total Logins</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="profilePasswordChanges">--</span>
                                <span class="stat-label">Password Changes</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="profileMemberSince">--</span>
                                <span class="stat-label">Member Since</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile settings content -->
                <div class="profile-content">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Notifications Section -->
        <section id="notifications-section" class="main-section">
            <div class="notifications-layout">
                <div class="notifications-header">
                    <h2>🔔 Notifications</h2>
                    <div class="notification-actions">
                        <button class="mark-all-read-btn" onclick="markAllNotificationsRead()">Mark All Read</button>
                        <div class="notification-filter">
                            <select id="notificationFilter">
                                <option value="all">All Notifications</option>
                                <option value="unread">Unread Only</option>
                                <option value="security">Security Alerts</option>
                                <option value="breach">Breach Alerts</option>
                                <option value="system">System Updates</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="notifications-list" id="notificationsList">
                    <!-- Dynamic notifications -->
                </div>
                
                <div class="notifications-pagination" id="notificationsPagination">
                    <!-- Pagination controls -->
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Security Best Practices -->
        <div class="security-best-practices">
            <h3>🔒 Professional Security Guidelines</h3>
            <div class="practices-grid">
                <div class="practice-item">
                    <div class="practice-icon">🔄</div>
                    <h4>Regular Rotation</h4>
                    <p>Change passwords every 90 days for critical accounts like banking and email</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">🚫</div>
                    <h4>Unique Passwords</h4>
                    <p>Never reuse passwords across different services or accounts</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">📱</div>
                    <h4>Two-Factor Authentication</h4>
                    <p>Always enable 2FA/MFA when available for additional security</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">🔍</div>
                    <h4>Monitor Accounts</h4>
                    <p>Regularly check for suspicious activity and unauthorized access</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">⚠️</div>
                    <h4>Phishing Awareness</h4>
                    <p>Be vigilant against social engineering and phishing attempts</p>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">🏢</div>
                    <h4>Enterprise Compliance</h4>
                    <p>Follow your organization's security policies and procedures</p>
                </div>
            </div>
        </div>

        <!-- Enhanced Footer -->
        <div class="footer-links">
            <div class="footer-section">
                <h4>Security & Privacy</h4>
                <a href="{{ url_for('terms') }}" target="_blank">Terms of Service</a>
                <a href="{{ url_for('privacy') }}" target="_blank">Privacy Policy</a>
                <a href="{{ url_for('security') }}" target="_blank">Security Details</a>
            </div>
            <div class="footer-section">
                <h4>Support & Contact</h4>
                <a href="mailto:security@vaultguard.local">Security Contact</a>
                <a href="mailto:support@vaultguard.local">Technical Support</a>
                <a href="#help">Help Center</a>
            </div>
            <div class="footer-section">
                <h4>Legal & Compliance</h4>
                <p>© 2025 VaultGuard Secure</p>
                <p>Professional Grade Security</p>
                <p>HTTPS Protected • AES-256 Encrypted</p>
            </div>
        </div>
    </div>

    <!-- Enhanced Auth Modal -->
    {% if not logged_in %}
    <div class="auth-modal" id="authModal">
        <div class="auth-card">
            <button class="close-btn" id="closeModal">×</button>
            <h2 class="auth-title" id="authTitle">🔐 VaultGuard Secure Access</h2>
            <div class="security-auth-notice">
                <span class="security-icon">🔑</span>
                <span>HTTPS Protected • Enhanced Security • HaveIBeenPwned Integration</span>
            </div>
            
            <form class="auth-form" id="authForm" method="POST">
                <input type="text" class="auth-input" id="authUsername" name="username" placeholder="Username (3+ characters)" required autocomplete="username">
                
                <div class="auth-input-group" id="emailGroup" style="display: none;">
                    <input type="email" class="auth-input" id="authEmail" name="email" placeholder="Email (optional - for recovery & notifications)">
                    <small class="input-hint">Optional: Used for password recovery and security notifications</small>
                </div>
                
                <div class="auth-input-group" id="phoneGroup" style="display: none;">
                    <input type="tel" class="auth-input" id="authPhone" name="phone" placeholder="Phone (optional - for SMS alerts)">
                    <small class="input-hint">Optional: Format +1234567890 for SMS security alerts</small>
                </div>
                
                <input type="password" class="auth-input" id="authPassword" name="password" placeholder="Master Password (12+ characters)" required autocomplete="current-password">
                
                <div class="password-requirements">
                    <small>Strong password required: 12+ chars, uppercase, lowercase, numbers, symbols</small>
                </div>
                
                <div class="remember-device-group" style="display: none;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberDevice">
                        <span class="checkmark"></span>
                        <span>Trust this device</span>
                    </label>
                    <small class="checkbox-hint">Skip verification on this device for 30 days</small>
                </div>
                
                <button type="submit" class="auth-submit" id="authSubmit">Secure Login</button>
            </form>
            
            <div class="auth-links">
                <p class="auth-switch">
                    <span id="authSwitchText">Don't have an account?</span>
                    <a href="#" class="auth-link" id="authSwitchLink">Create Secure Account</a>
                </p>
                
                <div class="recovery-link" style="display: none;">
                    <a href="#" class="auth-link" id="forgotPasswordLink">Forgot Master Password?</a>
                </div>
            </div>
            
            <div class="auth-security-info">
                <h4>🛡️ Enhanced Security Features:</h4>
                <ul>
                    <li>HTTPS encryption for all data transmission</li>
                    <li>Account lockout after 3 failed attempts</li>
                    <li>Session timeout for security (30 minutes)</li>
                    <li>Zero-knowledge encryption architecture</li>
                    <li>Real-time breach monitoring</li>
                    <li>Multi-device security tracking</li>
                    <li>Email/SMS security notifications</li>
                    <li>OTP password recovery system</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Password Recovery Modal -->
    <div class="recovery-modal" id="recoveryModal">
        <div class="recovery-card">
            <button class="close-btn" onclick="closeRecoveryModal()">×</button>
            <h2 class="recovery-title">🔐 Password Recovery</h2>
            
            <div class="recovery-step" id="recoveryStep1">
                <h3>Step 1: Verify Identity</h3>
                <p>Enter your username, email, or phone number to receive a recovery code</p>
                <input type="text" class="auth-input" id="recoveryIdentifier" placeholder="Username, email, or phone number">
                <div class="recovery-method">
                    <label class="radio-label">
                        <input type="radio" name="recoveryMethod" value="email" checked>
                        <span>📧 Send code via email</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="recoveryMethod" value="sms">
                        <span>📱 Send code via SMS</span>
                    </label>
                </div>
                <button class="auth-submit" onclick="requestRecoveryCode()">Send Recovery Code</button>
            </div>
            
            <div class="recovery-step" id="recoveryStep2" style="display: none;">
                <h3>Step 2: Enter Recovery Code</h3>
                <p>Enter the 6-digit code sent to <span id="recoveryContact"></span></p>
                <input type="text" class="auth-input" id="recoveryCode" placeholder="Enter 6-digit code" maxlength="6">
                <input type="password" class="auth-input" id="newPassword" placeholder="New master password (12+ characters)">
                <input type="password" class="auth-input" id="confirmPassword" placeholder="Confirm new password">
                <button class="auth-submit" onclick="verifyRecoveryCode()">Reset Password</button>
                <p class="recovery-resend">
                    Didn't receive code? <a href="#" onclick="requestRecoveryCode()">Resend</a>
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p id="loadingMessage">Processing securely...</p>
        </div>
    </div>

    <!-- Notification Toasts Container -->
    <div class="notifications-container" id="notificationsContainer">
        <!-- Dynamic notifications appear here -->
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
    <script>
        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize application
            if (typeof initialize === 'function') {
                initialize();
            }
            
            // Initialize navigation
            initializeNavigation();
            
            // Initialize user interface
            initializeUserInterface();
            
            // Check for notifications
            if ({{ 'true' if logged_in else 'false' }}) {
                loadNotifications();
                loadUserProfile();
            }
        });

        // Navigation system
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.main-section');
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetSection = link.dataset.section;
                    showSection(targetSection);
                    
                    // Update active nav
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });
            });
        }

        function showSection(sectionName) {
            const sections = document.querySelectorAll('.main-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                
                // Load section-specific data
                switch(sectionName) {
                    case 'dashboard':
                        loadDashboard();
                        break;
                    case 'vault':
                        loadVaultData();
                        break;
                    case 'notifications':
                        loadNotifications();
                        break;
                    case 'profile':
                        loadUserProfile();
                        break;
                }
            }
        }

        // User interface initialization
        function initializeUserInterface() {
            // User menu dropdown
            const userMenuToggle = document.getElementById('userMenuToggle');
            const userDropdown = document.getElementById('userDropdown');
            
            if (userMenuToggle && userDropdown) {
                userMenuToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userDropdown.classList.toggle('show');
                });
                
                document.addEventListener('click', () => {
                    userDropdown.classList.remove('show');
                });
            }
            
            // Notification bell
            const notificationBell = document.getElementById('notificationBell');
            if (notificationBell) {
                notificationBell.addEventListener('click', () => {
                    showSection('notifications');
                });
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                showLoading('Loading security dashboard...');
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    updateDashboard(data.dashboard);
                }
            } catch (error) {
                console.error('Dashboard load error:', error);
                showNotification('Failed to load dashboard', 'error');
            } finally {
                hideLoading();
            }
        }

        function updateDashboard(dashboard) {
            // Update security score
            document.getElementById('securityScore').textContent = dashboard.security_score;
            document.getElementById('securityGrade').textContent = dashboard.security_grade;
            
            // Update stats
            document.getElementById('totalPasswords').textContent = dashboard.vault_stats.total_passwords;
            document.getElementById('strongPasswordsCount').textContent = dashboard.vault_stats.strong_passwords;
            document.getElementById('compromisedCount').textContent = dashboard.vault_stats.compromised_passwords;
            document.getElementById('oldPasswordsCount').textContent = dashboard.vault_stats.old_passwords;
            document.getElementById('vaultUsage').textContent = dashboard.vault_stats.vault_usage + '%';
            document.getElementById('trustedDevices').textContent = dashboard.devices.length;
            
            // Update recommendations
            updateRecommendations(dashboard.recommendations);
            
            // Update recent activity
            updateRecentActivity(dashboard.recent_activity);
        }

        function updateRecommendations(recommendations) {
            const container = document.getElementById('recommendationsList');
            if (!container) return;
            
            if (recommendations.length === 0) {
                container.innerHTML = '<div class="no-recommendations">🎉 All security recommendations completed!</div>';
                return;
            }
            
            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item ${rec.type}">
                    <div class="rec-icon">${getRecommendationIcon(rec.type)}</div>
                    <div class="rec-content">
                        <h4>${rec.title}</h4>
                        <p>${rec.description}</p>
                        <button class="rec-action-btn">${rec.action}</button>
                    </div>
                </div>
            `).join('');
        }

        function getRecommendationIcon(type) {
            const icons = {
                'urgent': '🚨',
                'important': '⚠️',
                'warning': '⚡',
                'suggestion': '💡'
            };
            return icons[type] || '💡';
        }

        // Password recovery functions
        async function requestRecoveryCode() {
            const identifier = document.getElementById('recoveryIdentifier').value;
            const method = document.querySelector('input[name="recoveryMethod"]:checked').value;
            
            try {
                showLoading('Sending recovery code...');
                const response = await fetch('/api/password-recovery/request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identifier, method })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('recoveryContact').textContent = data.masked_contact;
                    document.getElementById('recoveryStep1').style.display = 'none';
                    document.getElementById('recoveryStep2').style.display = 'block';
                    showNotification(data.message, 'success');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Recovery request failed', 'error');
            } finally {
                hideLoading();
            }
        }

        async function verifyRecoveryCode() {
            const identifier = document.getElementById('recoveryIdentifier').value;
            const otpCode = document.getElementById('recoveryCode').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            try {
                showLoading('Verifying code and resetting password...');
                const response = await fetch('/api/password-recovery/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        identifier, 
                        otp_code: otpCode, 
                        new_password: newPassword 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(data.message, 'success');
                    closeRecoveryModal();
                    // Redirect to login
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Password reset failed', 'error');
            } finally {
                hideLoading();
            }
        }

        function openRecoveryModal() {
            document.getElementById('recoveryModal').classList.add('show');
            closeAuthModal();
        }

        function closeRecoveryModal() {
            document.getElementById('recoveryModal').classList.remove('show');
            // Reset form
            document.getElementById('recoveryStep1').style.display = 'block';
            document.getElementById('recoveryStep2').style.display = 'none';
            document.getElementById('recoveryIdentifier').value = '';
            document.getElementById('recoveryCode').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        // Enhanced auth modal functionality
        function setAuthMode(isLogin) {
            const emailGroup = document.getElementById('emailGroup');
            const phoneGroup = document.getElementById('phoneGroup');
            const rememberGroup = document.querySelector('.remember-device-group');
            const recoveryLink = document.querySelector('.recovery-link');
            
            if (!isLogin) {
                // Registration mode
                if (emailGroup) emailGroup.style.display = 'block';
                if (phoneGroup) phoneGroup.style.display = 'block';
            } else {
                // Login mode
                if (emailGroup) emailGroup.style.display = 'none';
                if (phoneGroup) phoneGroup.style.display = 'none';
                if (rememberGroup) rememberGroup.style.display = 'block';
                if (recoveryLink) recoveryLink.style.display = 'block';
            }
        }

        // Initialize password recovery link
        document.addEventListener('DOMContentLoaded', function() {
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            if (forgotPasswordLink) {
                forgotPasswordLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    openRecoveryModal();
                });
            }
        });

        // Utility functions
        function showLoading(message = 'Processing...') {
            const overlay = document.getElementById('loadingOverlay');
            const messageEl = document.getElementById('loadingMessage');
            if (overlay) {
                if (messageEl) messageEl.textContent = message;
                overlay.style.display = 'flex';
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        async function loadNotifications() {
            try {
                const response = await fetch('/api/notifications');
                const data = await response.json();
                
                if (data.success) {
                    updateNotificationUI(data);
                }
            } catch (error) {
                console.error('Notifications load error:', error);
            }
        }

        function updateNotificationUI(data) {
            // Update notification count
            const countElements = document.querySelectorAll('.notification-count, #notificationCount, #dropdownNotificationBadge');
            countElements.forEach(el => {
                if (data.unread_count > 0) {
                    el.textContent = data.unread_count;
                    el.style.display = 'block';
                } else {
                    el.style.display = 'none';
                }
            });
        }

        async function loadUserProfile() {
            try {
                const response = await fetch('/api/me');
                const data = await response.json();
                
                if (data.success && data.authenticated) {
                    updateUserProfile(data);
                }
            } catch (error) {
                console.error('Profile load error:', error);
            }
        }

        function update
